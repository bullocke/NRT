<!doctype html>
<html>
  <head>
    <meta http-equiv="cache-control" content="max-age=0">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 11:00:00 GMT">
    <meta http-equiv="pragma" content="no-cache">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Near-real time forest monitoring by bullocke</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.0/mapbox-gl.css' rel='stylesheet' />
        <style>
              body { margin:0; padding:0; }
                #map { position:absolute; top:0; bottom:0; width:100%; }
            </style>
  </head>
  <body>
<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 30px;
        border-radius: 3px;
        width: 120px;
        border: 3px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        font-weight: bold;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border: 1px solid rgba(0,0,0,0.4);
        text-align: center;
    }

    #menu a:last-child {
        border: 1px solid rgba(0,0,0,0.4);
    }

    #menu a:hover {
        background-color: rgba(0,0,0,0.4);
        color: #ffffff;
        font-weight: bold;
        border: 1px solid rgba(0,0,0,0.4);
    }

    #menu a.active {
        background-color: #404040;
        border: 1px solid rgba(0,0,0,0.4);
        color: #ffffff;
        font-weight: bold;
    }
    #menu a.active:hover {
        background-color: rgba(0,0,0,0.4);
    }
</style>
    <div class="wrapper">
      <header>
        <h1 class="header">Near-real time forest monitoring </h1>
        <p class="header">Operational example of near-real time forest change detection using daily MODIS products (beta and work in progress).</p>
        <p>Scroll over pixel to view date of detected change in 'YEARDOY' format.</p>
        <ul>
          <li><a class="buttons github" href="https://github.com/bullocke/NRT">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/bullocke">bullocke</a></p>
       <!-- <a href = "https://www.bu.edu/earth/"><img src="images/BU.png" alt="Boston University" style="width:150px"></a> -->


      </header>
      <section>
        <h3>
        <nav id="menu"></nav>
        <div id='map' class='dark'></div>
        <img src="images/banner_full.jpg"> 



<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYnVsbG9ja2UiLCJhIjoiQ1dNTFJiVSJ9.-6m5HWxlG6pixRS8mRdb9g';
//mapboxgl.accessToken = 'sk.eyJ1IjoiYnVsbG9ja2UiLCJhIjoiY2lwMDVuaGwxMDJlZXVvbThnbzU0YXl4byJ9.InJ9GwQ4gTyt7BVHqGmmcA'
var boundary = {
"type": "FeatureCollection",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                                                                                
"features": [
{ "type": "Feature", "properties": { "cat": 301.000000, "h": 12.000000, "v": 9.000000 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -57.694743806959828, -10.082391078295466 ], [ -61.077804996132969, -10.082391078295466 ], [ -60.134656351037947, -0.089941052431901 ], [ -56.803835571896641, -0.089941052431901 ], [ -53.473014792755308, -0.089941052431901 ], [ -50.142194013613974, -0.089941052431901 ], [ -50.928621428613503, -10.082391078295466 ], [ -54.311682617786666, -10.082391078295466 ], [ -57.694743806959828, -10.082391078295466 ] ] ] } },
{ "type": "Feature", "properties": { "cat": 335.000000, "h": 10.000000, "v": 8.000000 }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -76.788760246744587, -0.089941052431901 ], [ -80.119581025885907, -0.089941052431901 ], [ -81.331170646103388, 9.902508973431665 ], [ -77.949980308969643, 9.902508973431665 ], [ -74.568789971835884, 9.902508973431665 ], [ -71.187599634702124, 9.902508973431665 ], [ -70.127118688461934, -0.089941052431901 ], [ -73.457939467603254, -0.089941052431901 ], [ -76.788760246744587, -0.089941052431901 ] ] ] } }
]
}
if (!mapboxgl.supported()) {
        alert('Your browser does not support this application. Sorry!');
        } else {

var map = new mapboxgl.Map({
    container: 'map', 
    style: 'mapbox://styles/mapbox/satellite-v9',
    center: [-55.0, -7.5],
    zoom: 7
});


map.on('load', function () {
    map.addSource('landsat-live', {
        "type": 'raster',
        "url": 'mapbox://mapbox.landsat-live',
        "tileSize": 256
    });
    map.addLayer({
        "id": "landsat-live",
        "type": "raster",
        "source": "landsat-live",
        "layout": {
            "visibility": "none",
        }
    });

    map.addSource("boundary", {
        "type": "geojson",
        "data": boundary
    });

    // Add a layer showing the markers.
    map.addLayer({
        "id": "boundary",
        "type": "line",
        "source": "boundary",
        "paint": {
            "line-color": "#46c6c6",
            "line-width": 2
        }
    });

    map.addSource('2015', {
        type: 'vector',
        url: 'mapbox://bullocke.2015'
    });
    map.addLayer({
        "id": "2015",
        "type": "fill",
        "source": "2015",
        "source-layer": "2015",
        "paint": {
            "fill-color": {
                property: 'Date',
                stops: [
                [2015001, '#ffffcc'],
                [2015365, '#fd8d3c']
                ]
            },

        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('confirmedchanges', {
        type: 'vector',
        url: 'mapbox://bullocke.Confirmed'
    });
    map.addLayer({
        "id": "confirmedchanges",
        "type": "fill",
        "source": "confirmedchanges",
        "source-layer": "confirmedchanges",
        "paint": {
            "fill-color": {
                property: 'Date',
                stops: [
                [2016001, '#fc4e2a'],
                [2016365, '#800026']
                ]
            },
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('lowprob', {
        type: 'vector',
        url: 'mapbox://bullocke.LowProb'
    });
    map.addLayer({
        "id": "lowprob",
        "type": "fill",
        "source": "lowprob",
        "source-layer": "lowprob",
        "paint": {
            "fill-color": "#6CFF00",
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('highprob', {
        type: 'vector',
        url: 'mapbox://bullocke.HighProb'
    });
    map.addLayer({
        "id": "highprob",
        "type": "fill",
        "source": "highprob",
        "source-layer": "highprob",
        "paint": {
            "fill-color": "#0000FF",
        },
        "layout": {
            "visibility": "visible",
        }
    });
});
        }

//Do popups for each year, this needs to be condensed. 
var popuphighprob = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['highprob'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popuplowprob.remove();
      return;
    }
    
    var feature = features[0];

    popuphighprob.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});

var popuplowprob = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['lowprob'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popuplowprob.remove();
      return;
    }
    
    var feature = features[0];

    popuplowprob.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});

var popup2016 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['confirmedchanges'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2016.remove();
      return;
    }
    
    var feature = features[0];

    popup2016.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});
var popup2015 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['2015'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2015.remove();
      return;
    }
    
    var feature = features[0];

    popup2015.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});


addLayer('Low Probability', 'lowprob');
addLayer('High Probability', 'highprob');
addLayer('2016', 'confirmedchanges');
addLayer('2015', '2015');
addLayer('Landsat', 'landsat-live');

function addLayer(name, id) {
    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = name;

    link.onclick = function (e) {
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(id, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(id, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(id, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
}
</script>
<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support or Contact</h3>

      </section>
      <footer>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        
  </body>
</html>
